{"version":3,"sources":["webpack:///webpack/bootstrap 2431e87caef2e3e07ae2","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///external \"fs\"","webpack:///external \"shelljs\"","webpack:///external \"url\"","webpack:///external \"axios\"","webpack:///external \"cheerio\"","webpack:///external \"robotto\"","webpack:///./src/index.js","webpack:///external \"regenerator-runtime\"","webpack:///external \"fs-extra\"","webpack:///external \"lodash\"","webpack:///./src/helpers.js"],"names":["q","q_visited","listRobotsTxt","LIMIT","TIMEOUT","USERAGENT","DELAY","checkUrl","oldUrl","length","fs","writeFileSync","JSON","stringify","uniq","console","log","Promise","resolve","reject","findIndex","data","indexOf","url","parse","host","position","currentUrl","splice","setTimeout","shift","then","hasRobotsTxt","has","push","robotto","canCrawl","err","isAllowed","main","axios","get","timeout","headers","res","urls","getUrl","writeContent","existsSync","fse","removeSync","urlPath","content","handleUrl","directory","path","rootDirectory","split","slice","join","shell","mkdir","robotsUrl","getRobotsUrl","maxRedirects","listUrl","regx","handleCurrentUrl","protocol","$","cheerio","load","map","i","el","link","attr","charAt","filter","test","includes"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2431e87caef2e3e07ae2","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"shelljs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"shelljs\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"url\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"url\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"cheerio\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cheerio\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"robotto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"robotto\"\n// module id = 6\n// module chunks = 0","import fs from 'fs'\nimport shell from 'shelljs';\nimport url from 'url'\nimport axios from 'axios'\nimport cheerio from 'cheerio'\nimport fse from 'fs-extra'\nimport robotto from 'robotto'\nimport { uniq } from 'lodash'\n\nimport { hasRobotsTxt, writeContent, getUrl } from './helpers'\n\nlet q = ['https://std.regis.ku.ac.th'], q_visited = [], listRobotsTxt = []\nconst LIMIT = 100, TIMEOUT = 1000, USERAGENT = 'bot', DELAY = 100\n\nconst checkUrl = async (oldUrl) => {\n\tif(q.length === 0 || q_visited.length === LIMIT) {\n\t\tfs.writeFileSync('listRobotsTxt.json', JSON.stringify(uniq(listRobotsTxt), null, 2), 'utf8')\n\t\tconsole.log('---END---')\n\t\treturn\n\t}\n\tnew Promise(async (resolve, reject) => {\n\t\tif (oldUrl) {\n\t\t\tlet position = await q.findIndex(data => data.indexOf(url.parse(oldUrl).host) === -1)\n\t\t\tlet currentUrl = (q.splice(position, 1))[0]\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve(currentUrl)\n\t\t\t}, DELAY);\n\t\t} else {\n\t\t\tresolve(q.shift())\n\t\t}\n\t}).then( currentUrl => {\n\t\thasRobotsTxt(currentUrl).then( has => has && listRobotsTxt.push(url.parse(currentUrl).host))\n\t\trobotto.canCrawl(USERAGENT, currentUrl, (err, isAllowed) => {\n\t\t\tif (isAllowed || err) {\n\t\t\t\tmain(currentUrl)\n\t\t\t} else {\n\t\t\t\tcheckUrl()\n\t\t\t}\n\t\t});\n\t})\n}\n\nconst main = async (currentUrl)  => {\n\ttry {\n\t\tconst res = await axios.get(currentUrl, { timeout: TIMEOUT, headers: { 'User-Agent': USERAGENT } })\n\t\tconsole.log('====================================');\n\t\tconsole.log(`${q_visited.length + 1} : `, currentUrl)\n\t\tq_visited.push(currentUrl)\n\t\tlet urls = getUrl(currentUrl, res.data, [...q, ...q_visited]);\n\t\tawait writeContent(currentUrl, res.data)\n\t\tq.push(...urls)\n\t\tconsole.log('====================================');\n\t\tcheckUrl(currentUrl)\n\t} catch (error) {\n\t\tcheckUrl(currentUrl)\n\t}\n}\n\nif (fs.existsSync('html')) fse.removeSync('html')\nif (fs.existsSync('listRobotsTxt.json')) fse.removeSync('listRobotsTxt.json')\ncheckUrl()\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"fs-extra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs-extra\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 11\n// module chunks = 0","import fs from 'fs'\nimport shell from 'shelljs'\nimport url from 'url'\nimport axios from 'axios'\nimport robotto from 'robotto'\nimport cheerio from 'cheerio'\n\nconst USERAGENT = 'bot', TIMEOUT = 1000\n\nexport const writeContent = (urlPath, content) => {\n\tconst handleUrl = url.parse(urlPath)\n\tlet directory\n\tif(handleUrl.path === '/') {\n\t\tdirectory = `html/${handleUrl.host}`;\n\t} else {\n\t\tdirectory = `html/${handleUrl.host}${handleUrl.path}`;\n\t}\n\tconst rootDirectory = directory.split('/').slice(0, -1).join('/')\n\tif (!fs.existsSync(rootDirectory)) {\n\t\tshell.mkdir('-p', rootDirectory);\n\t}\n\tfs.writeFileSync(directory, content, 'utf8')\n}\n\nexport const hasRobotsTxt = async (urlPath) => {\n\tconst robotsUrl = robotto.getRobotsUrl(urlPath)\n\ttry {\n\t\tconst res = await axios.get(robotsUrl, { maxRedirects: 0, timeout: TIMEOUT, headers: { 'User-Agent': USERAGENT } })\n\t\treturn true\n\t} catch (error) {\n\t\treturn false\n\t}\n}\n\nexport const getUrl = (currentUrl, content, listUrl) => {\n\tconst regx = /.(html|htm)/g\n\tconst handleCurrentUrl = url.parse(currentUrl)\n\tconst { protocol, host, path } = handleCurrentUrl\n\tconst $ = cheerio.load(content)\n\tlet urls = $('a').map((i, el) => {\n\t\tlet link = $(el).attr('href')\n\t\tif (url.parse(link).protocol) {\n\t\t\treturn link\n\t\t}\n\t\tif (link.charAt(0) === '/') {\n\t\t\treturn `${protocol}//${host}${link}`\n\t\t} else {\n\t\t\treturn `${protocol}//${host}${path.split('/').slice(0, -1).join('/')}/${link}`\n\t\t}\n\t}).get();\n\turls = urls.filter(data => regx.test(data) && !listUrl.includes(data))\n\treturn urls\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/helpers.js"],"sourceRoot":""}